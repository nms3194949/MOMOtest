<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>資產負債表試算（含匯出 PNG）</title>
<!-- 匯出功能套件 -->
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<style>
  :root{
    --deep:#0A1221;--card:#0C152A;--line:#2a3550;
    --ink:#EDEFF5;--muted:#9AA4B2;
    --pos:#39C27A;--neg:#E25A5A;--gold:#C9A227;
  }
  html,body{margin:0;background:var(--deep);color:var(--ink);
    font-family:"Noto Sans TC","PingFang TC",sans-serif;}
  .wrap{max-width:800px;margin:0 auto;padding:24px;}
  h2{margin-top:24px;color:var(--gold);border-bottom:1px solid var(--line);padding-bottom:4px;}
  table{width:100%;border-collapse:collapse;margin-top:12px;}
  th,td{border-bottom:1px solid var(--line);padding:8px;text-align:center;}
  th{background:#111a2f;}
  select,input{background:#0f1a33;color:var(--ink);
    border:1px solid var(--line);border-radius:6px;padding:6px;width:100%;}
  input[type="number"]{text-align:right;}
  tfoot td{font-weight:700;}
  .summary{margin-top:24px;padding:12px;border:1px solid var(--line);
    border-radius:8px;background:var(--card);}
  .pos{color:var(--pos)}.neg{color:var(--neg)}
  .btn{background:var(--gold);color:#000;padding:8px 14px;
    border:none;border-radius:8px;font-weight:600;cursor:pointer;margin-top:12px;}
  .btn:hover{opacity:.9;}
</style>
</head>
<body>
<div class="wrap" id="captureArea">
  <h2>資產</h2>
  <table id="tblAsset">
    <thead>
      <tr><th>資產</th><th>金額（萬元）</th><th>月配息（元/月）</th></tr>
    </thead>
    <tbody>
      <tr>
        <td><select>
          <option value="">請選擇</option>
          <option>活存</option>
          <option>定存</option>
          <option>股票</option>
          <option>台幣保單</option>
          <option>外幣保單</option>
          <option>不動產</option>
          <option>租金</option>
        </select></td>
        <td><input type="number" step="0.01" placeholder="0"></td>
        <td><input type="number" step="1" placeholder="0"></td>
      </tr>
    </tbody>
  </table>
  <button class="btn" onclick="addRow('tblAsset')">＋ 新增資產列</button>

  <h2>負債</h2>
  <table id="tblDebt">
    <thead>
      <tr><th>負債</th><th>金額（萬元）</th><th>月支出（元/月）</th></tr>
    </thead>
    <tbody>
      <tr>
        <td><select>
          <option value="">請選擇</option>
          <option>信貸</option>
          <option>車貸</option>
          <option>房貸</option>
          <option>學貸</option>
          <option>孝親費</option>
        </select></td>
        <td><input type="number" step="0.01" placeholder="0"></td>
        <td><input type="number" step="1" placeholder="0"></td>
      </tr>
    </tbody>
  </table>
  <button class="btn" onclick="addRow('tblDebt')">＋ 新增負債列</button>

  <div class="summary">
    <p>資產總額：<span id="sumAsset">0</span> 萬元</p>
    <p>負債總額：<span id="sumDebt">0</span> 萬元</p>
    <p>每月淨現金流：<span id="netFlow" class="pos">0</span> 元/月</p>
  </div>
</div>

<div style="text-align:center;">
  <button class="btn" onclick="exportPNG()">📸 匯出 PNG</button>
</div>

<script>
function addRow(tblId){
  const tbl=document.getElementById(tblId).querySelector("tbody");
  const first=tbl.querySelector("tr");
  const clone=first.cloneNode(true);
  clone.querySelectorAll("input").forEach(i=>i.value="");
  clone.querySelectorAll("select").forEach(s=>s.value="");
  tbl.appendChild(clone);
  bindInputs();
}

function bindInputs(){
  document.querySelectorAll("input").forEach(el=>{
    el.removeEventListener("input",calc);
    el.addEventListener("input",calc);
  });
}

function calc(){
  let sumAsset=0,sumDebt=0,flowIn=0,flowOut=0;
  document.querySelectorAll("#tblAsset tbody tr").forEach(r=>{
    const v1=parseFloat(r.children[1].querySelector("input").value)||0;
    const v2=parseFloat(r.children[2].querySelector("input").value)||0;
    sumAsset+=v1; flowIn+=v2;
  });
  document.querySelectorAll("#tblDebt tbody tr").forEach(r=>{
    const v1=parseFloat(r.children[1].querySelector("input").value)||0;
    const v2=parseFloat(r.children[2].querySelector("input").value)||0;
    sumDebt+=v1; flowOut+=v2;
  });
  const net=flowIn-flowOut;
  document.getElementById("sumAsset").textContent=sumAsset.toFixed(2);
  document.getElementById("sumDebt").textContent=sumDebt.toFixed(2);
  const netEl=document.getElementById("netFlow");
  netEl.textContent=net.toFixed(0);
  netEl.className=net>=0?"pos":"neg";
}

// 匯出 PNG
function exportPNG(){
  const target=document.getElementById("captureArea");
  html2canvas(target,{scale:2,backgroundColor:"#0A1221"}).then(canvas=>{
    const link=document.createElement("a");
    link.download="資產負債表.png";
    link.href=canvas.toDataURL("image/png");
    link.click();
  });
}

bindInputs();
</script>
</body>
</html>